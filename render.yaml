services:
  # Service untuk Aplikasi Web Laravel (PHP)
  - type: web
    name: edumap-app
    # Menggunakan runtime Docker karena Render merekomendasikannya untuk PHP
    runtime: docker
    dockerfilePath: ./Dockerfile.render # Kita akan buat file ini
    plan: free
    healthCheckPath: /
    envVars:
      # Render akan menyediakan URL ini secara otomatis
      - key: APP_URL
        fromService:
          type: web
          name: edumap-app
          property: url
      - key: APP_KEY
        generateValue: true
      - key: APP_ENV
        value: production
      - key: DB_CONNECTION
        value: pgsql # Kita menggunakan PostgreSQL
      # Menggunakan satu connection string yang disediakan oleh layanan database Render
      - key: DATABASE_URL # Laravel akan otomatis menggunakan ini
        fromDatabase:
          name: edumap-db
          property: connectionString
    autoDeploy: true

  # Service untuk Database PostgreSQL
  - type: pserv # Private Service (Database)
    name: edumap-db
    # Menggunakan image Docker resmi PostgreSQL
    runtime: image
    image:
      url: postgres:15 # Menggunakan PostgreSQL versi 15
    plan: free
    # Volume untuk menyimpan data database secara persisten
    disk:
      name: pg-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1